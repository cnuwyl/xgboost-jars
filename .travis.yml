language: java

# TODO: is there a way to define the matrix avoiding duplication?
matrix:
  include:
    - os: linux
      sudo: required
      group: edge
      services:
        - docker
      env:
        - SCALA_VERSION=2.11.12
        - SCALA_BINARY_VERSION=2.11
        - XGBOOST_COMPLETE_VERSION=${SCALA_BINARY_VERSION}-${XGBOOST_BASE_VERSION}

    - os: osx
      osx_image: xcode9.3
      env:
        - SCALA_VERSION=2.11.12
        - SCALA_BINARY_VERSION=2.11
        - XGBOOST_COMPLETE_VERSION=${SCALA_BINARY_VERSION}-${XGBOOST_BASE_VERSION}

env:
  global:
    - HADOOP_VERSION=2.6.0-cdh5.5.0
    - SPARK_VERSION=2.4.1
    - XGBOOST_VERSION_DMLC=1.1.0
    - XGBOOST_BASE_VERSION=${XGBOOST_VERSION_DMLC}-criteo-20200802-071ef500

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    brew update;
    brew upgrade cmake;
    fi;

install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then sh travis/install.sh; fi

script:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then sh travis/test_and_package.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
    sh travis/install.sh;
    sh xgboost/jvm-packages/dev/build-linux.sh --skip-tests;
    cp xgboost/jvm-packages/xgboost4j/target/xgboost4j_$XGBOOST_COMPLETE_VERSION.jar $TRAVIS_BUILD_DIR/xgboost4j_$XGBOOST_COMPLETE_VERSION-$TRAVIS_OS_NAME.jar;
    cp xgboost/jvm-packages/xgboost4j-spark/target/xgboost4j-spark_$XGBOOST_COMPLETE_VERSION.jar $TRAVIS_BUILD_DIR/xgboost4j-spark_$XGBOOST_COMPLETE_VERSION.jar;
    fi;

deploy:
  provider: releases
  api_key:
    secure: qI+P6MbKukoV0jHMvv55FMj2NJHwR3hCUJuSro3KqiTti8yiVg64QcvbplB3J7KZoi7jwlmDOZ5IV30ZDOWx3imGPBJd9kFzFTR/KQE/HAP3kdzgXKmvoc/fTaPlH0WvGzDq+yZBI9HAP/MJ447iQNO4+7sXKaBM0VNhfsITJy+VIzOlafMky6fkWNTvS7JFcIjTQqv7nHBhbqDIDpeLVG3sL6IsqlqmjHwCrHJFV/WSw3TNa2kdnLLUkZ/AsX49bswiYlMSd/wyQr5LpN3XctXUpcWXR93sCHNHydG9m3ZpdabO0qI8+Vm9glilbOYIPq/WiRngXJlIg+gAJpHQP2xgbp91a+e9wDWHo5+ndSMGny811kO6/jigpIHFWD7+VG84sk1zQ6n41gNofZHscGxMF7ombcTlmiSjW0w53HLAP+XTpWoXmnAdsOBaCl53SUcenWMmxAhW4E694OqLOrmkpeM7hkC9hULoylp/Gcfi0dOTpQtvn0/XNKupssdNGyzpsUseQ8dMIIRIZiCmuXxhtLtpYIpxkPPBd84np1L7Wn6a+Z5DAqRs6a246gdVjNre9CjH8P0I+st3+1NOx5Wchutriz4IVbufo26Kysvafucyxk6kXy6A12m4oeMSNpOYYFdRYr+wXVXA+f7q9nktsJexRK9XhMr5oKIFBZU=
  file:
    - xgboost4j_$XGBOOST_COMPLETE_VERSION-$TRAVIS_OS_NAME.jar
    - xgboost4j-spark_$XGBOOST_COMPLETE_VERSION.jar
  skip_cleanup: true
  overwrite: true
  on:
    repo: criteo-forks/xgboost-jars
    tags: true
